{"ast":null,"code":"import { create } from 'zustand';\nexport const useVoiceStore = create((set, get) => ({\n  // Initial state\n  isRecording: false,\n  isProcessing: false,\n  isPlaying: false,\n  messages: [],\n  currentTranscript: '',\n  connectionStatus: 'disconnected',\n  currentIntent: undefined,\n  extractedEntities: undefined,\n  suggestions: undefined,\n  urgencyLevel: undefined,\n  error: undefined,\n  // Actions\n  setRecording: isRecording => set({\n    isRecording\n  }),\n  setProcessing: isProcessing => set({\n    isProcessing\n  }),\n  setPlaying: isPlaying => set({\n    isPlaying\n  }),\n  setConnectionStatus: connectionStatus => set({\n    connectionStatus\n  }),\n  setError: error => set({\n    error\n  }),\n  addMessage: message => set(state => ({\n    messages: [...state.messages, {\n      ...message,\n      id: `msg_${Date.now()}_${Math.random()}`\n    }]\n  })),\n  updateLastMessage: updates => set(state => {\n    const messages = [...state.messages];\n    if (messages.length > 0) {\n      messages[messages.length - 1] = {\n        ...messages[messages.length - 1],\n        ...updates\n      };\n    }\n    return {\n      messages\n    };\n  }),\n  setCurrentTranscript: currentTranscript => set({\n    currentTranscript\n  }),\n  updateCurrentIntent: currentIntent => set({\n    currentIntent\n  }),\n  updateExtractedEntities: extractedEntities => set({\n    extractedEntities\n  }),\n  updateSuggestions: suggestions => set({\n    suggestions\n  }),\n  updateUrgencyLevel: urgencyLevel => set({\n    urgencyLevel\n  }),\n  clearMessages: () => set({\n    messages: [],\n    currentTranscript: '',\n    currentIntent: undefined,\n    extractedEntities: undefined,\n    suggestions: undefined\n  }),\n  reset: () => set({\n    messages: [],\n    currentTranscript: '',\n    currentIntent: undefined,\n    extractedEntities: undefined,\n    suggestions: undefined,\n    urgencyLevel: undefined,\n    error: undefined,\n    isRecording: false,\n    isProcessing: false,\n    isPlaying: false\n  }),\n  processVoiceResponse: response => {\n    var _data$ai_response, _response$data;\n    const {\n      addMessage,\n      updateCurrentIntent,\n      updateExtractedEntities,\n      updateSuggestions,\n      updateUrgencyLevel,\n      setError,\n      setProcessing\n    } = get();\n    setProcessing(false);\n\n    // Handle errors\n    if (response.error || !response.success) {\n      setError(response.error || 'Unknown error occurred');\n      addMessage({\n        type: 'assistant',\n        content: `I'm sorry, there was an error: ${response.error || 'Please try again'}`,\n        timestamp: new Date().toISOString()\n      });\n      return;\n    } else {\n      setError(undefined);\n    }\n    const data = response.data;\n\n    // Add user message if transcript exists\n    if (data !== null && data !== void 0 && data.transcript) {\n      addMessage({\n        type: 'user',\n        content: data.transcript,\n        timestamp: response.timestamp,\n        isAudio: true\n      });\n    }\n\n    // Process AI response\n    if (data !== null && data !== void 0 && (_data$ai_response = data.ai_response) !== null && _data$ai_response !== void 0 && _data$ai_response.response) {\n      const aiMessage = {\n        type: 'assistant',\n        content: data.ai_response.response,\n        timestamp: response.timestamp,\n        isAudio: !!data.audio,\n        intent: data.ai_response.intent,\n        entities: data.ai_response.extracted_info\n      };\n      addMessage(aiMessage);\n\n      // Update global state with extracted information\n      if (data.ai_response.intent) {\n        updateCurrentIntent(data.ai_response.intent);\n      }\n      if (data.ai_response.extracted_info) {\n        updateExtractedEntities(data.ai_response.extracted_info);\n      }\n    }\n\n    // Play audio if available - backend returns audio in data.audio field\n    const audioData = (_response$data = response.data) === null || _response$data === void 0 ? void 0 : _response$data.audio;\n    if (audioData) {\n      try {\n        const audioBlob = new Blob([Uint8Array.from(atob(audioData), c => c.charCodeAt(0))], {\n          type: 'audio/wav'\n        });\n        const audioUrl = URL.createObjectURL(audioBlob);\n        const audio = new Audio(audioUrl);\n\n        // Add user interaction event listeners for audio playback\n        const playAudio = async () => {\n          try {\n            const {\n              setPlaying\n            } = get();\n            setPlaying(true);\n            await audio.play();\n            audio.onended = () => setPlaying(false);\n          } catch (playError) {\n            console.error('Audio play failed:', playError);\n            const {\n              setPlaying\n            } = get();\n            setPlaying(false);\n            // If autoplay fails, try with user interaction\n            document.addEventListener('click', () => {\n              audio.play().catch(console.error);\n            }, {\n              once: true\n            });\n          }\n        };\n        playAudio();\n      } catch (error) {\n        console.error('Error playing audio:', error);\n      }\n    }\n\n    // Handle appointment actions\n    if (data !== null && data !== void 0 && data.appointment_action) {\n      console.log('Appointment action:', data.appointment_action);\n      // This could trigger additional UI updates or notifications\n    }\n  }\n}));","map":{"version":3,"names":["create","useVoiceStore","set","get","isRecording","isProcessing","isPlaying","messages","currentTranscript","connectionStatus","currentIntent","undefined","extractedEntities","suggestions","urgencyLevel","error","setRecording","setProcessing","setPlaying","setConnectionStatus","setError","addMessage","message","state","id","Date","now","Math","random","updateLastMessage","updates","length","setCurrentTranscript","updateCurrentIntent","updateExtractedEntities","updateSuggestions","updateUrgencyLevel","clearMessages","reset","processVoiceResponse","response","_data$ai_response","_response$data","success","type","content","timestamp","toISOString","data","transcript","isAudio","ai_response","aiMessage","audio","intent","entities","extracted_info","audioData","audioBlob","Blob","Uint8Array","from","atob","c","charCodeAt","audioUrl","URL","createObjectURL","Audio","playAudio","play","onended","playError","console","document","addEventListener","catch","once","appointment_action","log"],"sources":["D:/My projects/AI DOk/doc/frontend/src/stores/voiceStore.ts"],"sourcesContent":["import { create } from 'zustand';\r\nimport { VoiceState, VoiceMessage, VoiceResponse, ExtractedEntities } from '../types';\r\n\r\ninterface VoiceStore extends VoiceState {\r\n  // Enhanced state\r\n  currentIntent?: string;\r\n  extractedEntities?: ExtractedEntities;\r\n  suggestions?: string[];\r\n  urgencyLevel?: 'low' | 'medium' | 'high' | 'emergency';\r\n  error?: string;\r\n  \r\n  // Actions\r\n  setRecording: (isRecording: boolean) => void;\r\n  setProcessing: (isProcessing: boolean) => void;\r\n  setPlaying: (isPlaying: boolean) => void;\r\n  setConnectionStatus: (status: VoiceState['connectionStatus']) => void;\r\n  setError: (error: string | undefined) => void;\r\n  addMessage: (message: Omit<VoiceMessage, 'id'>) => void;\r\n  updateLastMessage: (updates: Partial<VoiceMessage>) => void;\r\n  setCurrentTranscript: (transcript: string) => void;\r\n  updateCurrentIntent: (intent: string) => void;\r\n  updateExtractedEntities: (entities: ExtractedEntities) => void;\r\n  updateSuggestions: (suggestions: string[]) => void;\r\n  updateUrgencyLevel: (level: 'low' | 'medium' | 'high' | 'emergency') => void;\r\n  clearMessages: () => void;\r\n  reset: () => void;\r\n  processVoiceResponse: (response: VoiceResponse) => void;\r\n}\r\n\r\nexport const useVoiceStore = create<VoiceStore>((set, get) => ({\r\n  // Initial state\r\n  isRecording: false,\r\n  isProcessing: false,\r\n  isPlaying: false,\r\n  messages: [],\r\n  currentTranscript: '',\r\n  connectionStatus: 'disconnected',\r\n  currentIntent: undefined,\r\n  extractedEntities: undefined,\r\n  suggestions: undefined,\r\n  urgencyLevel: undefined,\r\n  error: undefined,\r\n\r\n  // Actions\r\n  setRecording: (isRecording) => set({ isRecording }),\r\n  \r\n  setProcessing: (isProcessing) => set({ isProcessing }),\r\n  \r\n  setPlaying: (isPlaying) => set({ isPlaying }),\r\n  \r\n  setConnectionStatus: (connectionStatus) => set({ connectionStatus }),\r\n  \r\n  setError: (error) => set({ error }),\r\n  \r\n  addMessage: (message) => set((state) => ({\r\n    messages: [\r\n      ...state.messages,\r\n      {\r\n        ...message,\r\n        id: `msg_${Date.now()}_${Math.random()}`,\r\n      }\r\n    ]\r\n  })),\r\n  \r\n  updateLastMessage: (updates) => set((state) => {\r\n    const messages = [...state.messages];\r\n    if (messages.length > 0) {\r\n      messages[messages.length - 1] = {\r\n        ...messages[messages.length - 1],\r\n        ...updates\r\n      };\r\n    }\r\n    return { messages };\r\n  }),\r\n  \r\n  setCurrentTranscript: (currentTranscript) => set({ currentTranscript }),\r\n  \r\n  updateCurrentIntent: (currentIntent) => set({ currentIntent }),\r\n  \r\n  updateExtractedEntities: (extractedEntities) => set({ extractedEntities }),\r\n  \r\n  updateSuggestions: (suggestions) => set({ suggestions }),\r\n  \r\n  updateUrgencyLevel: (urgencyLevel) => set({ urgencyLevel }),\r\n  \r\n  clearMessages: () => set({ \r\n    messages: [], \r\n    currentTranscript: '',\r\n    currentIntent: undefined,\r\n    extractedEntities: undefined,\r\n    suggestions: undefined\r\n  }),\r\n  \r\n  reset: () => set({\r\n    messages: [],\r\n    currentTranscript: '',\r\n    currentIntent: undefined,\r\n    extractedEntities: undefined,\r\n    suggestions: undefined,\r\n    urgencyLevel: undefined,\r\n    error: undefined,\r\n    isRecording: false,\r\n    isProcessing: false,\r\n    isPlaying: false\r\n  }),\r\n  \r\n  processVoiceResponse: (response) => {\r\n    const { \r\n      addMessage,\r\n      updateCurrentIntent,\r\n      updateExtractedEntities,\r\n      updateSuggestions,\r\n      updateUrgencyLevel,\r\n      setError,\r\n      setProcessing\r\n    } = get();\r\n    \r\n    setProcessing(false);\r\n    \r\n    // Handle errors\r\n    if (response.error || !response.success) {\r\n      setError(response.error || 'Unknown error occurred');\r\n      addMessage({\r\n        type: 'assistant',\r\n        content: `I'm sorry, there was an error: ${response.error || 'Please try again'}`,\r\n        timestamp: new Date().toISOString()\r\n      });\r\n      return;\r\n    } else {\r\n      setError(undefined);\r\n    }\r\n    \r\n    const data = response.data;\r\n    \r\n    // Add user message if transcript exists\r\n    if (data?.transcript) {\r\n      addMessage({\r\n        type: 'user',\r\n        content: data.transcript,\r\n        timestamp: response.timestamp,\r\n        isAudio: true\r\n      });\r\n    }\r\n    \r\n    // Process AI response\r\n    if (data?.ai_response?.response) {\r\n      const aiMessage: Omit<VoiceMessage, 'id'> = {\r\n        type: 'assistant',\r\n        content: data.ai_response.response,\r\n        timestamp: response.timestamp,\r\n        isAudio: !!data.audio,\r\n        intent: data.ai_response.intent,\r\n        entities: data.ai_response.extracted_info\r\n      };\r\n\r\n      addMessage(aiMessage);\r\n      \r\n      // Update global state with extracted information\r\n      if (data.ai_response.intent) {\r\n        updateCurrentIntent(data.ai_response.intent);\r\n      }\r\n      \r\n      if (data.ai_response.extracted_info) {\r\n        updateExtractedEntities(data.ai_response.extracted_info);\r\n      }\r\n    }\r\n    \r\n    // Play audio if available - backend returns audio in data.audio field\r\n    const audioData = response.data?.audio;\r\n    if (audioData) {\r\n      try {\r\n        const audioBlob = new Blob([\r\n          Uint8Array.from(atob(audioData), c => c.charCodeAt(0))\r\n        ], { type: 'audio/wav' });\r\n        \r\n        const audioUrl = URL.createObjectURL(audioBlob);\r\n        const audio = new Audio(audioUrl);\r\n        \r\n        // Add user interaction event listeners for audio playback\r\n        const playAudio = async () => {\r\n          try {\r\n            const { setPlaying } = get();\r\n            setPlaying(true);\r\n            await audio.play();\r\n            audio.onended = () => setPlaying(false);\r\n          } catch (playError) {\r\n            console.error('Audio play failed:', playError);\r\n            const { setPlaying } = get();\r\n            setPlaying(false);\r\n            // If autoplay fails, try with user interaction\r\n            document.addEventListener('click', () => {\r\n              audio.play().catch(console.error);\r\n            }, { once: true });\r\n          }\r\n        };\r\n        \r\n        playAudio();\r\n        \r\n      } catch (error) {\r\n        console.error('Error playing audio:', error);\r\n      }\r\n    }\r\n    \r\n    // Handle appointment actions\r\n    if (data?.appointment_action) {\r\n      console.log('Appointment action:', data.appointment_action);\r\n      // This could trigger additional UI updates or notifications\r\n    }\r\n  }\r\n}));\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}